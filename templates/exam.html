<!DOCTYPE html>
<html>
   <head>
   	<meta http-equiv="Content-Type" content="text/html; charset=utf8" />
        <link href="favicon.png" rel="shortcut icon"/>
        <title>文言文词义消歧</title>
        <link rel="stylesheet" href="/static/layout.css" type="text/css">
        <script type="text/javascript" src="/static/jquery-1.3.2.min.js"></script>
        <script type="text/javascript" src="/static/cookie.js"></script>
        <script type="text/javascript" src="/static/user.js?v=1.0"></script>
        <script type="text/javascript" src="/static/sentence.js?v=1.1"></script>
        <script type="text/javascript" src="/static/jquery.md5.js"></script>
	<script>
 	function solve(){
 		d = {}
 		tags = ['stem','substem','select1', 'select2', 'select3', 'select4','subselect1', 'subselect2', 'subselect3', 'subselect4']
 		for (i in tags)
 			d[tags[i]] = document.getElementById(tags[i]).value
 		jsondata = JSON.stringify(d)
 		$.post('/solve/'+jsondata,
 		function(data){
 			result = JSON.parse(data)
 			if (result['success'] == 0){
 				document.getElementById('result').innerHTML = '发生错误'
 				return
 			}
 			editdistance = [getEditDistance(result,d['select1']),getEditDistance(result,d['select2']),getEditDistance(result,d['select3']),getEditDistance(result,d['select4'])]
 			mind = 10000
 			ans = -1
 			for (i in editdistance){
 				if (editdistance[i] < mind){
 					ans = i
 					mind = editdistance[i]
 				}
 			}
 			if (result['type'] == 'tagging'){
 				document.getElementById('result').innerHTML = '释义：'+result['sense']+'<br>选项一距离：<br>'+editdistance[0]+'<br>选项二距离：<br>'+editdistance[1]+'<br>选项三距离：<br>'+editdistance[2]+'<br>选项四距离：<br>'+editdistance[3]+'<br>答案：选项'+String(ans+1)
 			}
 			if (result['type'] == 'sentence_pair'){
 				document.getElementById('result').innerHTML = '选项一：<br>释义1：'+result['sense1_1']+'<br>释义2：'+result['sense1_2']+'<br>相似度：'+result['sim1']+'<br>选项二：<br>释义1：'+result['sense2_1']+'<br>释义2：'+result['sense2_2']+'<br>相似度：'+result['sim2']+'<br>选项三：<br>释义1：'+result['sense3_1']+'<br>释义2：'+result['sense3_2']+'<br>相似度：'+result['sim3']+'<br>选项四：<br>释义1：'+result['sense4_1']+'<br>释义2：'+result['sense4_2']+'<br>相似度：'+result['sim4']+'<br>答案：'
 			}
 			//document.getElementById('result').innerHTML = data
 		}
 		)
 	}

 	function getEditDistance(a, b){
  if(a.length == 0) return b.length; 
  if(b.length == 0) return a.length; 

  var matrix = [];

  // increment along the first column of each row
  var i;
  for(i = 0; i <= b.length; i++){
    matrix[i] = [i];
  }

  // increment each column in the first row
  var j;
  for(j = 0; j <= a.length; j++){
    matrix[0][j] = j;
  }

  // Fill in the rest of the matrix
  for(i = 1; i <= b.length; i++){
    for(j = 1; j <= a.length; j++){
      if(b.charAt(i-1) == a.charAt(j-1)){
        matrix[i][j] = matrix[i-1][j-1];
      } else {
        matrix[i][j] = Math.min(matrix[i-1][j-1] + 1, // substitution
                                Math.min(matrix[i][j-1] + 1, // insertion
                                         matrix[i-1][j] + 1)); // deletion
      }
    }
  }

  return matrix[b.length][a.length];
};

 	function test(){
 		alert(getEditDistance('1111','12312'))
 	}

	</script>
   </head>
   
<body>
	<div id="header">
			<div id="logo">
				<img src="/static/thumt-logo.png"  alt="logo"/>
			</div>
			<h1>文言文词义消歧系统</h1>
		</div>

	<div id="input_area">
		<button id="segment_button" onclick="solve()">解题</button>
		<button id="segment_button" onclick="test()">测试</button>
		 <br>
			<table border="0" width="100%" cellpadding="10">
				<tr>
					<td valign="top">
					题干: <input type="text" size=50 id="stem">
					</td>
				</tr>
				<tr>
					<td valign="top">
					副题干: <input type="text" size=30 id="substem">
					</td>
				</tr>
				<tr>
					<td valign="top">
					选项一: <input type="text" size=20 id="select1"> <input type="text" size=20 id="subselect1">
					</td>
				</tr>
				<tr>
					<td valign="top">
					选项二: <input type="text" size=20 id="select2"> <input type="text" size=20 id="subselect2">
					</td>
				</tr>
				<tr>
					<td valign="top">
					选项三: <input type="text" size=20 id="select3"> <input type="text" size=20 id="subselect3">
					</td>
				</tr>
				<tr>
					<td valign="top">
					选项四: <input type="text" size=20 id="select4"> <input type="text" size=20 id="subselect4">
					</td>
				</tr>
				<tr>
					<td>
					结果: <p id='result'>11</p>
					</td>
				</tr>
			</table>
			<br/>
		</div>
		
</body>
</html>